<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html >
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="css/style3.css" type="text/css" />
<script type="text/javascript" src="js/jquery-1.11.3.min.js" ></script>
<script type="text/javascript" src="js/qrcode.js" ></script>
<script type="text/javascript" src="js/qrcode.min.js" ></script>
<script type="text/javascript" src="js/dateformat.js"></script>
<script type="text/javascript">

function genOrderNumber() {
	var order = new Date().getTime();
	document.getElementById("txnRef").value=order;
	
	getRequestDateTime();
}

function getRequestDateTime() {
	var now = new Date();
	document.form.txnDatetime.value = DateFormat.format(now, "yyyy-MM-ddThh:mm:ssZ");	
}
function change(obj){
	var node = document.getElementById("zqq");
	if("17"==obj.value){
		node.style.display="";
	}else{
		node.style.display="none";
    }
}
</script>
</head>
<body onload="genOrderNumber();">

	<div class="form_content">
    <form id="form" name="form" action="ytPay" method="post" >
    <fieldset>
        <legend>Order</legend>
        
        <div class="form-row">
            <div class="field-label"><label for="field">txnRef:</label></div>
            <div class="field-widget"><input name="txnRef" id="txnRef" class="required" title="Enter txnRef" value="" maxlength="16"/></div>
        </div>
        
        <div class="form-row">
            <div class="field-label"><label for="field">txnDatetime:</label></div>
            <div class="field-widget"><input name="txnDatetime" id="txnDatetime" class="required" title="Enter txnDatetime" value="" maxlength="20"/></div>
        </div>
        
        <div class="form-row">
            <div class="field-label"><label for="field">country:</label></div>
            <div class="field-widget"><input name="country" id="country" class="required" title="Enter country" value="ID" maxlength="2"/></div>
        </div>
        
        <div class="form-row">
            <div class="field-label"><label for="field">currency:</label></div>
            <div class="field-widget"><input name="currency" id="currency" class="required" title="Enter currency" value="360"/></div>
        </div>
        
        <div class="form-row">
        	<div class="field-label"><label for="field">payment_option:</label></div>
            <div class="field-widget">
                <select id="payment_option" name="payment_option" class="validate-selection" title="Choose payment_option" onchange="change(this)">
                    <option value="">--选择支付渠道--</option>
					<option value="04">DOKU WALLET</option> 
					<option value="15">Credit Card</option>
					<option value="14">ALFA DOKU</option> 
					<option value="03">KlikBCA</option>
					<option value="24">BCA KLICKPAY</option> 
					<option value="05">VA ATM</option>
					<option value="17">Recurring Payment</option>
                </select>
            </div>    
        </div>
        
        <div class="form-row">
            <div class="field-label"><label for="field">amount:</label></div>
            <div class="field-widget"><input name="amount" id="amount" class="required" title="Enter amount" value="100.00"/></div>
        </div>
        
        <div class="form-row">
            <div class="field-label"><label for="field">merId:</label></div>
            <div class="field-widget"><input name="merId" id="merId" class="required" title="Enter merId" value="5822"/></div>
        </div>
        
        <div class="form-row">
            <div class="field-label"><label for="field">email:</label></div>
            <div class="field-widget"><input name="email" id="email" class="required" title="Enter email" value="123@qq.com"/></div>
        </div>
        
        <div class="form-row">
            <div class="field-label"><label for="field">name:</label></div>
            <div class="field-widget"><input name="name" id="name" class="required" title="Enter name" value="DOKU Test"/></div>
        </div>
        
        <!-- 
        <div class="form-row">
            <div class="field-label"><label for="field">description:</label></div>
            <div class="field-widget"><input name="description" id="description" class="required" title="Enter description" value="Basket testing 1,100.00,1,100.00"/></div>
        </div>
         -->
        <div class="form-row">
	        <fieldset class="table">
		    	<legend>description</legend>
		    	<table  width="100%" style="border-collapse:collapse;" id="tableList">
			    	<tr>
			    		<td width="25%">orderName</td>
			    		<td width="25%">unitAmt</td>
			    		<td width="25%">unit</td>
			    		<td width="25%">subAmt</td>
			    	</tr>
			    	<tr id="description1">
			    		<td ><input name="orderName1" id="orderName1" class="table" title="" value=""/></td>
			    		<td ><input name="unitAmt1" id="unitAmt1" class="table" title="" value=""/></td>
			    		<td ><input name="unit1" id="unit1" class="table" title="" value=""/></td>
			    		<td ><input name="subAmt1" id="subAmt1" class="table" title="" value=""/></td>
			    	</tr>
		    	</table>
		    	<br/>
		    	<span style="display: none"><input id="index" name="index" value="1"/></span>
		    	
		    	<div style="float:left"><input type="button" class="submit" value="Add" id="btnAdd"  onclick="add()"/></div>
		    	<div style="float:left">&nbsp;&nbsp;</div>
		    	<div style="float:left"><input type="button" class="submit" value="Del" id="btnDel"  onclick="del()"/></div>
		    </fieldset> 
        </div>
        <!-- 分期付款 -->
        <div id="zqq" style="display:none">
	        <div class="form-row">
	            <div class="field-label"><label for="field">customer_id:</label></div>
	            <div class="field-widget"><input name="customer_id" id="customer_id" class="required" title="Enter customer_id" value=""/></div>
	        </div>
	        
	        <div class="form-row">
	            <div class="field-label"><label for="field">bill_number:</label></div>
	            <div class="field-widget"><input name="bill_number" id="bill_number" class="required" title="Enter bill_number" value=""/></div>
	        </div>
	        
	        <div class="form-row">
	            <div class="field-label"><label for="field">bill_detail:</label></div>
	            <div class="field-widget"><input name="bill_detail" id="bill_detail" class="required" title="Enter bill_detail" value=""/></div>
	        </div>
	        
	        <div class="form-row">
	        	<div class="field-label"><label for="field">bill_type:</label></div>
	            <div class="field-widget">
	                <select id="bill_type" name="bill_type" class="validate-selection" title="Choose bill_type" onchange="">
	                    <option value="">--Choose bill_type--</option>
						<option value="S">Shopping</option> 
						<option value="I">Installment</option>
						<option value="D">Donation</option> 
						<option value="P">Payment</option>
	                </select>
	            </div>    
	        </div>
	        
	        <div class="form-row">
	            <div class="field-label"><label for="field">startdate:</label></div>
	            <div class="field-widget"><input name="bill_type" id="startdate" class="required" title="Enter startdate" value=""/></div>
	        </div>
	        
	        <div class="form-row">
	            <div class="field-label"><label for="field">enddate:</label></div>
	            <div class="field-widget"><input name="enddate" id="enddate" class="required" title="Enter enddate" value=""/></div>
	        </div>
	        
	        <div class="form-row">
	        	<div class="field-label"><label for="field">execute_type:</label></div>
	            <div class="field-widget">
	                <select id="execute_type" name="execute_type" class="validate-selection" title="Choose execute_type" onchange="">
	                    <option value="">--Choose execute_type--</option>
						<option value="DAY">DAY</option> 
						<option value="DATE">DATE</option>
						<option value="FULLDATE">FULLDATE</option>
	                </select>
	            </div>    
	        </div>
	        
	        <div class="form-row">
	            <div class="field-label"><label for="field">execute_date:</label></div>
	            <div class="field-widget"><input name="execute_date" id="execute_date" class="required" title="Enter execute_date" value=""/></div>
	        </div>
	        
	        <div class="form-row">
	            <div class="field-label"><label for="field">execute_month:</label></div>
	            <div class="field-widget"><input name="execute_month" id="execute_month" class="required" title="Enter execute_month" value=""/></div>
	        </div>
	        
	        <div class="form-row">
	            <div class="field-label"><label for="field">flat_status:</label></div>
	            <div class="field-widget"><input name="flat_status" id="flat_status" class="required" title="Enter flat_status" value=""/></div>
	        </div>
	        
	        <div class="form-row">
	            <div class="field-label"><label for="field">register_amount:</label></div>
	            <div class="field-widget"><input name="register_amount" id="register_amount" class="required" title="Enter register_amount" value=""/></div>
	        </div>
        </div>
    </fieldset>
    <table>
    <tr>
    	<td width="98%"></td>
    	<td>
    		<input type="button" class="submit" value="Submit" id="btn"  onclick="openOrder()"/>
    	</td>
    </tr>
    </table> 
    </form>
	   
    <fieldset class="table">
    	<legend>Result</legend>
    	<table  width="100%" style="border-collapse:collapse;">
    	<tr>
    		<td width="25%">sysCode</td>
    		<td width="25%">sysMsg</td>
    		<td width="25%">sysDatetime</td>
    		<td width="25%">redirectLink</td>
    	</tr>
    	<tr>
    		<td id="sysCode">null</td>
    		<td id="sysMsg">null</td>
    		<td id="sysDatetime">null</td>
    		<td id="redirectLink">null</td>
    	</tr>
    	</table>
    </fieldset> 
    </div>
    <div class="ali-pay" style="display:block;" >
		<div style="text-align: center;">
			<div id="qrcode" style="width:256px; height:256px; margin-top:15px;"></div>
		</div>
	</div>
	<div id="show">
	</div>
</body>
<script type="text/javascript">
function openOrder(){
	var nsysCode = document.getElementById("sysCode");
	var nsysMsg = document.getElementById("sysMsg");
	var nsysDatetime = document.getElementById("sysDatetime");
	var nredirectLink = document.getElementById("redirectLink");
	var show = document.getElementById("show");
	
	nsysCode.innerText="null";
	nsysMsg.innerText="null";
	nsysDatetime.innerText="null";
	nredirectLink.innerText="null";
	
	var params = $("#form").serialize();
	   $.ajax( {  
	       type : "POST",  
	       url : "DokuPay",  
	       data : params,  
	       success : function(msg) {  
	    		var obj = jQuery.parseJSON(msg);

	    		var sysCode = obj.system.sysCode;
				var sysMsg = obj.system.sysMsg;
				var sysDatetime = obj.system.sysDatetime;
				var redirectLink = obj.system.redirectLink;
	    		
				nsysCode.innerText=sysCode;
				nsysMsg.innerText=sysMsg;
				nsysDatetime.innerText=sysDatetime;
				nredirectLink.innerText=redirectLink;
				
				if(redirectLink!=null&&redirectLink!=""){
	    			show.innerHTML = redirectLink;
	    			document.getElementById("pay_form").submit();
	    		}
				
	       }  
	   });
}

var index_d = 1;
function add(){
	addElementTr(index_d);
}
function addElementTr(data) {
	var parent = document.getElementById("tableList");
	data++;
	//添加 tr
	var tr = document.createElement("tr");
	//设置 属性
	tr.setAttribute("id", "description"+data);
	
	var td1 = document.createElement("td");
	var input1 = document.createElement("input");
	input1.setAttribute("name", "orderName"+data);
	input1.setAttribute("class", "table");
	td1.appendChild(input1);
	
	var td2 = document.createElement("td");
	var input2 = document.createElement("input");
	input2.setAttribute("name", "unitAmt"+data);
	input2.setAttribute("class", "table");
	td2.appendChild(input2);
	
	var td3 = document.createElement("td");
	var input3 = document.createElement("input");
	input3.setAttribute("name", "unit"+data);
	input3.setAttribute("class", "table");
	td3.appendChild(input3);
	
	var td4 = document.createElement("td");
	var input4 = document.createElement("input");
	input4.setAttribute("name", "subAmt"+data);
	input4.setAttribute("class", "table");
	td4.appendChild(input4);
	
	tr.appendChild(td1);
	tr.appendChild(td2);
	tr.appendChild(td3);
	tr.appendChild(td4);
	parent.appendChild(tr);
	index_d = data;
	
	var indexNode = document.getElementById("index");
	indexNode.value=index_d;
}

function del(){
	delElementTr(index_d);
}
function delElementTr(data) {
	if(data==1) return;
	var parent = document.getElementById("tableList");
	var child = document.getElementById("description"+data);
	parent.removeChild(child);
	index_d = index_d - 1;
	
	var indexNode = document.getElementById("index");
	indexNode.value=index_d;
}
</script>
</html>